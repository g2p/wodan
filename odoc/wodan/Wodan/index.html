<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wodan (wodan.Wodan)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">wodan</a> &#x00BB; Wodan</nav><h1>Module <code>Wodan</code></h1><p>The Wodan module allows access to Wodan filesystems</p><p>The entry point is <a href="Make/index.html"><code>Wodan.Make</code></a>, which returns a <a href="module-type-S/index.html"><code>Wodan.S</code></a> module supporting filesystem operations</p></header><dl><dt class="spec exception" id="exception-BadMagic"><a href="#exception-BadMagic" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">BadMagic</span></code></dt><dd><p>Raised when trying to open a superblock and it doesn't have the magic tag for Wodan filesystems</p></dd></dl><dl><dt class="spec exception" id="exception-BadVersion"><a href="#exception-BadVersion" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">BadVersion</span></code></dt><dd><p>Raised when trying to open a superblock and it doesn't have a supported version for Wodan filesystems</p></dd></dl><dl><dt class="spec exception" id="exception-BadFlags"><a href="#exception-BadFlags" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">BadFlags</span></code></dt><dd><p>Raised when trying to open a superblock and it sets must-support flags that this version doesn't support</p></dd></dl><dl><dt class="spec exception" id="exception-BadCRC"><a href="#exception-BadCRC" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">BadCRC</span> <span class="keyword">of</span> int64</code></dt><dd><p>Raised when a block doesn't have the expected CRC</p><p>The exception carries the logical offset of the block.</p></dd></dl><dl><dt class="spec exception" id="exception-BadParams"><a href="#exception-BadParams" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">BadParams</span></code></dt><dd><p>Raised when <a href="module-type-SUPERBLOCK_PARAMS/index.html"><code>SUPERBLOCK_PARAMS</code></a> passed to the Make functor don't match actual settings saved in the superblock</p></dd></dl><dl><dt class="spec exception" id="exception-ReadError"><a href="#exception-ReadError" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">ReadError</span></code></dt><dd><p>Raised on IO failures reading a block</p></dd></dl><dl><dt class="spec exception" id="exception-WriteError"><a href="#exception-WriteError" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">WriteError</span></code></dt><dd><p>Raised on IO failures writing a block</p></dd></dl><dl><dt class="spec exception" id="exception-OutOfSpace"><a href="#exception-OutOfSpace" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">OutOfSpace</span></code></dt><dd><p>Raised when the filesystem doesn't have enough space to perform the operation</p></dd></dl><dl><dt class="spec exception" id="exception-NeedsFlush"><a href="#exception-NeedsFlush" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">NeedsFlush</span></code></dt><dd><p>Raised when the filesystem doesn't have enough space to perform an operation that would be possible if pending operations were flushed first</p></dd></dl><dl><dt class="spec exception" id="exception-BadKey"><a href="#exception-BadKey" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">BadKey</span> <span class="keyword">of</span> string</code></dt><dd><p>Raised when converting to a key is impossible, eg because the input doesn't have the expected length</p><p>The exception carries the original input.</p></dd></dl><dl><dt class="spec exception" id="exception-ValueTooLarge"><a href="#exception-ValueTooLarge" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">ValueTooLarge</span> <span class="keyword">of</span> string</code></dt><dd><p>Raised when converting to a value is impossible, because the input would not fit on a single block</p><p>Note that Wodan expects the user to chunk values if arbitrary lengths are to be supported. See also <code>Wodan_irmin</code>'s relationship to irmin-chunk.</p><p>The exception carries the original input</p></dd></dl><dl><dt class="spec exception" id="exception-BadNodeType"><a href="#exception-BadNodeType" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">BadNodeType</span> <span class="keyword">of</span> int</code></dt><dd><p>Raised when a block doesn't have a known and expected node type</p><p>The exception carries the type tag that couldn't be handled.</p></dd></dl><dl><dt class="spec module-type" id="module-type-EXTBLOCK"><a href="#module-type-EXTBLOCK" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-EXTBLOCK/index.html">EXTBLOCK</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>The standard Mirage block signature, with Wodan-specific extensions</p></dd></dl><dl><dt class="spec module" id="module-BlockCompat"><a href="#module-BlockCompat" class="anchor"></a><code><span class="keyword">module</span> BlockCompat : <span class="keyword">functor</span> (<a href="BlockCompat/index.html#argument-1-B">B</a> : Mirage_block.S) <span>&#45;&gt;</span> <a href="index.html#module-type-EXTBLOCK">EXTBLOCK</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="index.html#module-BlockCompat">BlockCompat</a>.t = <a href="BlockCompat/index.html#argument-1-B">B</a>.t</code></dt><dd><p>Extend a basic Mirage block backend to provide Wodan-specific extensions</p></dd></dl><dl><dt class="spec value" id="val-sizeof_superblock"><a href="#val-sizeof_superblock" class="anchor"></a><code><span class="keyword">val</span> sizeof_superblock : int</code></dt><dd><p>A constant that represents the size of Wodan superblocks</p><p>Will be a power of two and a multiple of a standard sector size</p></dd></dl><dl><dt class="spec type" id="type-relax"><a href="#type-relax" class="anchor"></a><code><span class="keyword">type</span> relax</code><code> = </code><code>{</code><table class="record"><tr id="type-relax.magic_crc" class="anchored"><td class="def field"><a href="#type-relax.magic_crc" class="anchor"></a><code>magic_crc : bool;</code></td><td class="doc"><p>CRC errors ignored on any read where the magic CRC is used</p></td></tr><tr id="type-relax.magic_crc_write" class="anchored"><td class="def field"><a href="#type-relax.magic_crc_write" class="anchor"></a><code>magic_crc_write : bool;</code></td><td class="doc"><p>Write non-superblock blocks with the magic CRC</p></td></tr></table><code>}</code></dt><dd><p>Flags representing integrity features that will be relaxed</p><p>Passed at mount time through <a href="index.html#type-mount_options"><code>mount_options</code></a></p></dd></dl><dl><dt class="spec type" id="type-mount_options"><a href="#type-mount_options" class="anchor"></a><code><span class="keyword">type</span> mount_options</code><code> = </code><code>{</code><table class="record"><tr id="type-mount_options.fast_scan" class="anchored"><td class="def field"><a href="#type-mount_options.fast_scan" class="anchor"></a><code>fast_scan : bool;</code></td><td class="doc"><p>If enabled, instead of checking the entire filesystem when opening, leaf nodes won't be scanned. They will be scanned on open instead.</p></td></tr><tr id="type-mount_options.cache_size" class="anchored"><td class="def field"><a href="#type-mount_options.cache_size" class="anchor"></a><code>cache_size : int;</code></td><td class="doc"><p>How many blocks to keep in cache</p></td></tr><tr id="type-mount_options.relax" class="anchored"><td class="def field"><a href="#type-mount_options.relax" class="anchor"></a><code>relax : <a href="index.html#type-relax">relax</a>;</code></td><td class="doc"><p>Integrity invariants to relax</p></td></tr></table><code>}</code></dt><dd><p>All parameters that can't be read from the superblock</p></dd></dl><dl><dt class="spec module" id="module-OptionalSuperblockFlags"><a href="#module-OptionalSuperblockFlags" class="anchor"></a><code><span class="keyword">module</span> <a href="OptionalSuperblockFlags/index.html">OptionalSuperblockFlags</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Superblock flags that are supported but not required by this Wodan version</p></dd></dl><dl><dt class="spec module-type" id="module-type-SUPERBLOCK_PARAMS"><a href="#module-type-SUPERBLOCK_PARAMS" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-SUPERBLOCK_PARAMS/index.html">SUPERBLOCK_PARAMS</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>All parameters that can be read from the superblock</p></dd></dl><dl><dt class="spec module" id="module-Testing"><a href="#module-Testing" class="anchor"></a><code><span class="keyword">module</span> <a href="Testing/index.html">Testing</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Operations used when testing and fuzzing</p></dd></dl><dl><dt class="spec module" id="module-StandardSuperblockParams"><a href="#module-StandardSuperblockParams" class="anchor"></a><code><span class="keyword">module</span> <a href="StandardSuperblockParams/index.html">StandardSuperblockParams</a> : <a href="index.html#module-type-SUPERBLOCK_PARAMS">SUPERBLOCK_PARAMS</a></code></dt><dd><p>Defaults for <a href="module-type-SUPERBLOCK_PARAMS/index.html"><code>SUPERBLOCK_PARAMS</code></a></p></dd></dl><dl><dt class="spec value" id="val-standard_mount_options"><a href="#val-standard_mount_options" class="anchor"></a><code><span class="keyword">val</span> standard_mount_options : <a href="index.html#type-mount_options">mount_options</a></code></dt><dd><p>Defaults for <a href="index.html#type-mount_options"><code>mount_options</code></a></p></dd></dl><dl><dt class="spec value" id="val-read_superblock_params"><a href="#val-read_superblock_params" class="anchor"></a><code><span class="keyword">val</span> read_superblock_params : <span>(<span class="keyword">module</span> Mirage_block.S <span class="keyword">with</span> <span class="keyword">type</span> t = <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-relax">relax</a> <span>&#45;&gt;</span> <span><span>(<span class="keyword">module</span> <a href="module-type-SUPERBLOCK_PARAMS/index.html">SUPERBLOCK_PARAMS</a>)</span> Lwt.t</span></code></dt><dd><p>Read static filesystem parameters</p><p>These are set at creation time and recorded in the superblock. See <a href="index.html#val-open_for_reading"><code>open_for_reading</code></a> if all you need is to mount the filesystem.</p></dd></dl><dl><dt class="spec type" id="type-format_params"><a href="#type-format_params" class="anchor"></a><code><span class="keyword">type</span> format_params</code><code> = </code><code>{</code><table class="record"><tr id="type-format_params.logical_size" class="anchored"><td class="def field"><a href="#type-format_params.logical_size" class="anchor"></a><code>logical_size : int64;</code></td><td class="doc"><p>The number of blocks, including the superblock, that are part of the filesystem</p></td></tr><tr id="type-format_params.preroots_interval" class="anchored"><td class="def field"><a href="#type-format_params.preroots_interval" class="anchor"></a><code>preroots_interval : int64;</code></td><td class="doc"><p>The (maximum) interval between pre-roots. Pre-roots are used to ensure that bisection will not be slow on freshly-formatted devices.</p></td></tr></table><code>}</code></dt><dd><p>Parameters passed when creating a filesystem</p></dd></dl><dl><dt class="spec value" id="val-default_preroots_interval"><a href="#val-default_preroots_interval" class="anchor"></a><code><span class="keyword">val</span> default_preroots_interval : int64</code></dt></dl><dl><dt class="spec type" id="type-deviceOpenMode"><a href="#type-deviceOpenMode" class="anchor"></a><code><span class="keyword">type</span> deviceOpenMode</code><code> = </code><table class="variant"><tr id="type-deviceOpenMode.OpenExistingDevice" class="anchored"><td class="def constructor"><a href="#type-deviceOpenMode.OpenExistingDevice" class="anchor"></a><code>| </code><code><span class="constructor">OpenExistingDevice</span></code></td><td class="doc"><p>Open an existing device, read logical size from superblock</p></td></tr><tr id="type-deviceOpenMode.FormatEmptyDevice" class="anchored"><td class="def constructor"><a href="#type-deviceOpenMode.FormatEmptyDevice" class="anchor"></a><code>| </code><code><span class="constructor">FormatEmptyDevice</span> <span class="keyword">of</span> <a href="index.html#type-format_params">format_params</a></code></td><td class="doc"><p>Format a device, which must contain only zeroes, and use the given format_params</p></td></tr></table></dt><dd><p>Modes for opening a device, see <a href="module-type-S/index.html#val-prepare_io"><code>S.prepare_io</code></a></p></dd></dl><dl><dt class="spec module-type" id="module-type-S"><a href="#module-type-S" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Filesystem operations</p></dd></dl><dl><dt class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-B/index.html">B</a> : <a href="index.html#module-type-EXTBLOCK">EXTBLOCK</a>) <span>&#45;&gt;</span> <span class="keyword">functor</span> (<a href="Make/argument-2-P/index.html">P</a> : <a href="index.html#module-type-SUPERBLOCK_PARAMS">SUPERBLOCK_PARAMS</a>) <span>&#45;&gt;</span> <a href="index.html#module-type-S">S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="Make/index.html#type-disk">disk</a> = <a href="Make/index.html#argument-1-B">B</a>.t</code></dt><dd><p>Build a <a href="module-type-S/index.html"><code>Wodan.S</code></a> module given a backing device and parameters</p></dd></dl><dl><dt class="spec type" id="type-open_ret"><a href="#type-open_ret" class="anchor"></a><code><span class="keyword">type</span> open_ret</code><code> = </code><table class="variant"><tr id="type-open_ret.OPEN_RET" class="anchored"><td class="def constructor"><a href="#type-open_ret.OPEN_RET" class="anchor"></a><code>| </code><code><span class="constructor">OPEN_RET</span> : <span>(<span class="keyword">module</span> <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-S/index.html#type-root">root</a> = <span class="type-var">'a</span>)</span> * <span class="type-var">'a</span> * int64 <span>&#45;&gt;</span> <a href="index.html#type-open_ret">open_ret</a></code></td></tr></table></dt><dd><p>This is a type that packages together a <a href="module-type-S/index.html"><code>Wodan.S</code></a> with an opened root and the generation number read when mounting</p></dd></dl><dl><dt class="spec value" id="val-open_for_reading"><a href="#val-open_for_reading" class="anchor"></a><code><span class="keyword">val</span> open_for_reading : <span>(<span class="keyword">module</span> <a href="module-type-EXTBLOCK/index.html">EXTBLOCK</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="index.html#module-type-EXTBLOCK">EXTBLOCK</a>.t = <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-mount_options">mount_options</a> <span>&#45;&gt;</span> <span><a href="index.html#type-open_ret">open_ret</a> Lwt.t</span></code></dt><dd><p>Open an existing Wodan filesystem, getting static parameters from the superblock</p></dd></dl></div></body></html>